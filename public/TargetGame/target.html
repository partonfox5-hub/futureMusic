<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Target Catharsis</title>
 <link rel="stylesheet" href="style.css">
    <style>
        /* Force Ad Overlay to be on top of the canvas (z-index 0) and UI (z-index 100) */
        #ad-overlay {
            z-index: 9999 !important;
            background-color: rgba(0, 0, 0, 0.95); /* Ensure background isn't transparent */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* CHROME FIX: Force hardware acceleration so display updates happen instantly */
            /* transform: translateZ(0);
            will-change: opacity, display; */
        }
        /* Ensure the close button is clickable on mobile */
        #video-close-btn {
            z-index: 10000 !important;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Dynamic Background Layer -->
    <div id="bg-layer"></div>
    
    <!-- Rain/Ripple Canvas -->
    <canvas id="effect-canvas"></canvas>

    <!-- Main Game Canvas -->
    <canvas id="game-canvas"></canvas>

 <!-- UI Layer -->
    <div id="ui-layer">
        <div id="hud" class="hidden">
            <!-- Fixed Layout: Score and Time on left/center, Audio on far right, Level moved to not overlap -->
            <div id="top-bar" style="display: flex; justify-content: space-between; width: 100%; align-items: flex-start;">
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    <div id="score-board">Score: <span id="score-val">0</span> / <span id="target-val">500</span></div>
                    <div id="timer-board">Time: <span id="time-val">3:00</span></div>
                </div>
                
                <!-- Moved Level Display to the left of audio controls with margin -->
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="level-board" style="font-size: 20px; color: gold;">Level: <span id="level-val">1</span></div>
                    <div id="audio-controls" style="display: flex; gap: 5px; pointer-events: auto;">
                        <button id="btn-music" class="icon-btn">ðŸŽµ</button>
                        <button id="btn-sfx" class="icon-btn">ðŸ”Š</button>
                        <button id="btn-fullscreen" class="icon-btn">â›¶</button>
                    </div>
                </div>
            </div>

            <div id="chest-zone" class="hidden"></div>
            <!-- Sequence Tracker -->
            <div id="sequence-board"></div>
        </div>

        <!-- Color Choice Modal -->
        <div id="color-modal" class="hidden">
            <h2>CHOOSE A COLOR!</h2>
            <div id="color-options"></div>
        </div>

 <div id="main-menu">
            <!-- Decorative Images surrounding menu -->
            <img src="images/green_solid.png" class="menu-deco deco-green">
            <img src="images/blue_solid.png" class="menu-deco deco-blue">
            <img src="images/red_solid.png" class="menu-deco deco-red">
            <img src="images/gold_solid.png" class="menu-deco deco-gold">
            <img src="images/orange_solid.png" class="menu-deco deco-orange">

            <h1>Target Breaker</h1>
            <div class="menu-stack">
                <button id="btn-show-levels">Play / Select Level</button>
                <button id="btn-how-to">How to Play</button>
                <button id="btn-game-login">Login / Sync Account</button> <!-- NEW BUTTON -->
                <!-- Separate Button for URL -->
                <button onclick="window.open('https://www.futuremusic.online', '_blank')">futuremusic.online</button>
                <button id="btn-iap" style="font-size: 12px; margin-top: 10px;">Remove Ads ($1.99)</button>
            </div>
        </div>

        <div id="level-select-screen" class="hidden">
            <h2>Select Level</h2>
            <div id="level-select">
                <!-- Buttons generated by JS -->
            </div>
            <button id="btn-back-menu">Back</button>
        </div>

        <!-- NEW LOGIN MODAL -->
        <div id="login-modal" class="hidden" style="pointer-events: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); padding: 20px; border: 2px solid gold; border-radius: 10px; text-align: center; color: white; width: 300px; z-index: 2000;">
            <h2 style="color: gold; margin-bottom: 15px;">PILOT LOGIN</h2>
            <input type="email" id="login-email" placeholder="Email" style="width: 90%; padding: 10px; margin-bottom: 10px; background: #333; color: white; border: 1px solid #555;">
            <input type="password" id="login-pass" placeholder="Password" style="width: 90%; padding: 10px; margin-bottom: 15px; background: #333; color: white; border: 1px solid #555;">
            <button id="btn-submit-login">CONNECT</button>
            <button id="btn-cancel-login" style="background: #444; border-color: #666; font-size: 14px;">Cancel</button>
            <p id="login-status" style="margin-top: 10px; font-size: 12px; color: yellow;"></p>
        </div>


        <div id="game-over" class="hidden">
            <h2 id="go-title">Level Complete!</h2>
            <p>Score: <span id="go-score">0</span></p>
            <button id="btn-restart">Replay</button>
            <button id="btn-next-level" class="hidden">Next Level</button>
            <button id="btn-menu">Menu</button>
        </div>

        <!-- Tutorial Modal -->
        <div id="tutorial-modal" class="hidden">
            <h2 id="tut-title">How to Play</h2>
            <div id="tut-content">
                <img id="tut-img" src="" alt="Tutorial Image" style="max-height: 150px; display:block; margin: 0 auto 10px auto;">
                <p id="tut-text"></p>
            </div>
            <div id="tut-nav">
                <button id="btn-tut-prev">Previous</button>
                <span id="tut-page">1/5</span>
                <button id="btn-tut-next">Next</button>
            </div>
            <button id="btn-tut-skip" style="margin-top:15px; background:#444;">Return to Menu</button>
        </div>
        
        <!-- Ad Warning (Small overlay during game) -->
        <div id="ad-warning" class="hidden">Ad in <span id="ad-countdown">10</span>s</div>

    </div> <!-- CLOSING DIV FOR ui-layer MOVED HERE -->
        
   <!-- Ad Warning (Small overlay during game) -->
        <div id="ad-warning" class="hidden">Ad in <span id="ad-countdown">10</span>s</div>
        
    </div> <!-- CLOSING DIV FOR ui-layer -->

    <!-- Unified Ad Overlay - MOVED OUTSIDE UI LAYER with FIXED POSITION -->
    <div id="ad-overlay" class="hidden" style="position: fixed !important; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2147483647 !important; background: rgba(0,0,0,1); pointer-events: auto !important;">
        
        <!-- GOOGLE ADS CONTAINER -->
        <div id="google-ad-container" class="hidden">
            <!-- Insert your responsive AdSense ins tag here -->
            <ins class="adsbygoogle"
                    style="display:block; width: 300px; height: 250px; margin: 0 auto;"
                    data-ad-client="ca-pub-YOUR_ADSENSE_PUBLISHER_ID"
                    data-ad-slot="YOUR_AD_SLOT_ID"
                    data-full-width-responsive="true"></ins>
            <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
            <div id="google-ad-timer">Ad Displaying...</div>
        </div>

        <!-- CUSTOM VIDEO CONTAINER -->
        <div id="video-ad-container" class="hidden">
            <div id="video-ui-bar">
                <div id="video-countdown">00</div>
                <div id="video-close-btn" class="hidden">X</div>
            </div>
            <!-- Playsinline required for mobile auto-play -->
            <video id="ad-video-player" playsinline style="width:100%; height:100%; object-fit:contain;"></video>
        </div>

    </div>

    <!-- Scripts -->
    <script src="js/bundle.js"></script>
</body>
</html>