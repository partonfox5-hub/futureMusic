<%- include('partials/header') %>

<section class="max-w-6xl mx-auto py-12 px-4">
    
    <!-- ON-SCREEN DEBUGGER (Visible if DB fails) -->
    <% if (typeof debugError !== 'undefined' && debugError) { %>
        <div class="bg-red-900/90 border border-red-500 text-white p-6 rounded-xl mb-12 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-red-500"></div>
            <h3 class="text-xl font-bold mb-2 flex items-center gap-2">
                <span>⚠️</span> SYSTEM DIAGNOSTIC: CONNECTION FAILURE
            </h3>
            <div class="space-y-2 font-mono text-sm opacity-90">
                <p><strong class="text-red-300">STATUS:</strong> <%= typeof dbStatus !== 'undefined' ? dbStatus : 'UNKNOWN' %></p>
                <p><strong class="text-red-300">ERROR:</strong> <%= debugError %></p>
                <hr class="border-red-500/50 my-2">
                <p class="text-xs italic">
                    <% if (debugError.includes('password authentication')) { %>
                        <strong>FIX:</strong> Your DB_PASSWORD is incorrect. Check your environment variables.
                    <% } else if (debugError.includes('does not exist')) { %>
                        <strong>FIX:</strong> Your DB_NAME is incorrect. Check your environment variables.
                    <% } else if (debugError.includes('ENOENT')) { %>
                        <strong>FIX:</strong> Cloud SQL Connection string is missing or Cloud SQL Auth Proxy is not running.
                    <% } else if (typeof dbStatus !== 'undefined' && dbStatus === 'CONFIG_MISSING') { %>
                        <strong>FIX:</strong> Environment variables (DB_USER, DB_NAME) are not set on the server.
                    <% } else { %>
                        <strong>FIX:</strong> Check server logs for full stack trace.
                    <% } %>
                </p>
            </div>
        </div>
    <% } %>

    <h1 class="text-4xl md:text-6xl text-center mb-16 text-gold brand-font">Physical Assets</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12">
        <% if (merch && merch.length > 0) { %>
            <% merch.forEach(function(item) { %>
                <div class="glass-card rounded-xl overflow-hidden group flex flex-col h-full hover:border-[#D4AF37] transition-all duration-300">
                    <!-- Image Container -->
                    <a href="/merch/<%= item.id %>" class="relative h-64 bg-gray-900 overflow-hidden block">
                        <img src="<%= item.image_url %>" onerror="this.src='https://placehold.co/400x400/111/D4AF37?text=NO+IMAGE'" alt="<%= item.name %>" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute top-4 right-4 bg-black/80 text-[#D4AF37] px-3 py-1 font-bold rounded border border-[#D4AF37]">
                            $<%= Number(item.price).toFixed(2) %>
                        </div>
                    </a>

                    <div class="p-6 flex flex-col flex-grow">
                        <a href="/merch/<%= item.id %>">
                            <h3 class="text-2xl font-bold text-white mb-2 hover:text-[#D4AF37] transition-colors"><%= item.name %></h3>
                        </a>
                        
                        <p class="text-gray-400 text-sm mb-6 flex-grow line-clamp-2"><%= item.description %></p>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <!-- View Details -->
                            <a href="/merch/<%= item.id %>" class="btn-outline text-center py-3 text-xs font-bold rounded hover:bg-[#D4AF37]/10 transition-colors">
                                DETAILS
                            </a>

                            <!-- Quick Add (Uses SKU for Cart) -->
                            <button class="btn-gold py-3 text-xs font-bold add-to-cart-btn hover:scale-105 transition-transform" 
                                data-id="<%= item.sku %>" 
                                data-name="<%= item.name %>"
                                data-type="merch">
                                QUICK ADD
                            </button>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="col-span-full text-center py-12">
                <p class="text-gray-400">Inventory currently offline. Please check back later.</p>
            </div>
        <% } %>
    </div>
</section>

<!-- Store Logic loaded here -->
<script src="/js/store.js"></script>
<%- include('partials/footer') %>